<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>组件的通信 3：找到任意组件实例——findComponents 系列方法 | wangjunget</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.d2b52029.css" as="style"><link rel="preload" href="/assets/js/app.5fc14d0c.js" as="script"><link rel="preload" href="/assets/js/3.49a4f85b.js" as="script"><link rel="preload" href="/assets/js/35.39fb3530.js" as="script"><link rel="prefetch" href="/assets/js/10.5c9ac91e.js"><link rel="prefetch" href="/assets/js/11.2d7ca541.js"><link rel="prefetch" href="/assets/js/12.028623ee.js"><link rel="prefetch" href="/assets/js/13.31e7559e.js"><link rel="prefetch" href="/assets/js/14.d0db8cfa.js"><link rel="prefetch" href="/assets/js/15.263c9f1a.js"><link rel="prefetch" href="/assets/js/16.02e6fd27.js"><link rel="prefetch" href="/assets/js/17.7c40e68f.js"><link rel="prefetch" href="/assets/js/18.e543beda.js"><link rel="prefetch" href="/assets/js/19.1dfb246f.js"><link rel="prefetch" href="/assets/js/2.938d3f47.js"><link rel="prefetch" href="/assets/js/20.57228dc9.js"><link rel="prefetch" href="/assets/js/21.79d6023c.js"><link rel="prefetch" href="/assets/js/22.cf17a0cf.js"><link rel="prefetch" href="/assets/js/23.69c5667c.js"><link rel="prefetch" href="/assets/js/24.d2a78d45.js"><link rel="prefetch" href="/assets/js/25.780bbedd.js"><link rel="prefetch" href="/assets/js/26.7e38854f.js"><link rel="prefetch" href="/assets/js/27.963317c7.js"><link rel="prefetch" href="/assets/js/28.64c30fba.js"><link rel="prefetch" href="/assets/js/29.d9cee65a.js"><link rel="prefetch" href="/assets/js/30.d7bd987d.js"><link rel="prefetch" href="/assets/js/31.e96f3ecb.js"><link rel="prefetch" href="/assets/js/32.b77c3adf.js"><link rel="prefetch" href="/assets/js/33.54deba64.js"><link rel="prefetch" href="/assets/js/34.39ad3fbe.js"><link rel="prefetch" href="/assets/js/36.035d8b7c.js"><link rel="prefetch" href="/assets/js/37.ba3b3540.js"><link rel="prefetch" href="/assets/js/38.30bdeff7.js"><link rel="prefetch" href="/assets/js/39.12cc4154.js"><link rel="prefetch" href="/assets/js/4.384a11e2.js"><link rel="prefetch" href="/assets/js/40.d474a5c1.js"><link rel="prefetch" href="/assets/js/41.2715253e.js"><link rel="prefetch" href="/assets/js/42.18d6069d.js"><link rel="prefetch" href="/assets/js/43.10834f2a.js"><link rel="prefetch" href="/assets/js/44.0eaf9041.js"><link rel="prefetch" href="/assets/js/45.6d0122b7.js"><link rel="prefetch" href="/assets/js/46.9133de75.js"><link rel="prefetch" href="/assets/js/47.a805aca5.js"><link rel="prefetch" href="/assets/js/5.c24cdbf4.js"><link rel="prefetch" href="/assets/js/6.a439550b.js"><link rel="prefetch" href="/assets/js/7.3f6fd47e.js"><link rel="prefetch" href="/assets/js/8.fe6395f4.js"><link rel="prefetch" href="/assets/js/9.fdfd8a68.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d2b52029.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">wangjunget</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Vue/" class="nav-link">Vue</a></li><li class="dropdown-subitem"><a href="/JavaScript/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/Css/" class="nav-link">Css</a></li></ul></li><li class="dropdown-item"><h4>开发工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Python/" class="nav-link">Python</a></li><li class="dropdown-subitem"><a href="/Git/" class="nav-link">Git</a></li><li class="dropdown-subitem"><a href="/Linux/" class="nav-link">Linux</a></li></ul></li></ul></div></div> <a href="https://github.com/wangjunget/blog-vuepress" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Vue/" class="nav-link">Vue</a></li><li class="dropdown-subitem"><a href="/JavaScript/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/Css/" class="nav-link">Css</a></li></ul></li><li class="dropdown-item"><h4>开发工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Python/" class="nav-link">Python</a></li><li class="dropdown-subitem"><a href="/Git/" class="nav-link">Git</a></li><li class="dropdown-subitem"><a href="/Linux/" class="nav-link">Linux</a></li></ul></li></ul></div></div> <a href="https://github.com/wangjunget/blog-vuepress" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/Books/Vue.js 组件精讲/" class="sidebar-heading clickable open"><span>Vue.js 组件精讲</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Books/Vue.js 组件精讲/开篇：Vue.js 的精髓——组件.html" class="sidebar-link">开篇：Vue.js 的精髓——组件</a></li><li><a href="/Books/Vue.js 组件精讲/基础：Vue.js 组件的三个 API：prop、event、slot.html" class="sidebar-link">基础：Vue.js 组件的三个 API：prop、event、slot</a></li><li><a href="/Books/Vue.js 组件精讲/组件的通信 1：provide   inject.html" class="sidebar-link">组件的通信 1：provide / inject</a></li><li><a href="/Books/Vue.js 组件精讲/组件的通信 2：派发与广播——自行实现 dispatch 和 broadcast 方法.html" class="sidebar-link">组件的通信 2：派发与广播——自行实现 dispatch 和 broadcast 方法</a></li><li><a href="/Books/Vue.js 组件精讲/实战 1：具有数据校验功能的表单组件——Form.html" class="sidebar-link">实战 1：具有数据校验功能的表单组件——Form</a></li><li><a href="/Books/Vue.js 组件精讲/组件的通信 3：找到任意组件实例——findComponents 系列方法.html" class="active sidebar-link">组件的通信 3：找到任意组件实例——findComponents 系列方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Books/Vue.js 组件精讲/组件的通信 3：找到任意组件实例——findComponents 系列方法.html#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/Books/Vue.js 组件精讲/组件的通信 3：找到任意组件实例——findComponents 系列方法.html#实现" class="sidebar-link">实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Books/Vue.js 组件精讲/组件的通信 3：找到任意组件实例——findComponents 系列方法.html#向上找到最近的指定组件——findcomponentupward" class="sidebar-link">向上找到最近的指定组件——findComponentUpward</a></li><li class="sidebar-sub-header"><a href="/Books/Vue.js 组件精讲/组件的通信 3：找到任意组件实例——findComponents 系列方法.html#向上找到所有的指定组件——findcomponentsupward" class="sidebar-link">向上找到所有的指定组件——findComponentsUpward</a></li><li class="sidebar-sub-header"><a href="/Books/Vue.js 组件精讲/组件的通信 3：找到任意组件实例——findComponents 系列方法.html#向下找到最近的指定组件——findcomponentdownward" class="sidebar-link">向下找到最近的指定组件——findComponentDownward</a></li><li class="sidebar-sub-header"><a href="/Books/Vue.js 组件精讲/组件的通信 3：找到任意组件实例——findComponents 系列方法.html#向下找到所有指定的组件——findcomponentsdownward" class="sidebar-link">向下找到所有指定的组件——findComponentsDownward</a></li><li class="sidebar-sub-header"><a href="/Books/Vue.js 组件精讲/组件的通信 3：找到任意组件实例——findComponents 系列方法.html#找到指定组件的兄弟组件——findbrotherscomponents" class="sidebar-link">找到指定组件的兄弟组件——findBrothersComponents</a></li></ul></li><li class="sidebar-sub-header"><a href="/Books/Vue.js 组件精讲/组件的通信 3：找到任意组件实例——findComponents 系列方法.html#结语" class="sidebar-link">结语</a></li><li class="sidebar-sub-header"><a href="/Books/Vue.js 组件精讲/组件的通信 3：找到任意组件实例——findComponents 系列方法.html#扩展阅读" class="sidebar-link">扩展阅读</a></li></ul></li><li><a href="/Books/Vue.js 组件精讲/实战 2：组合多选框组件——CheckboxGroup &amp; Checkbox.html" class="sidebar-link">实战 2：组合多选框组件——CheckboxGroup &amp; Checkbox</a></li><li><a href="/Books/Vue.js 组件精讲/Vue 的构造器——extend 与手动挂载——$mount.html" class="sidebar-link">Vue 的构造器——extend 与手动挂载——$mount</a></li><li><a href="/Books/Vue.js 组件精讲/实战 3：动态渲染 .vue 文件的组件—— Display.html" class="sidebar-link">实战 3：动态渲染 .vue 文件的组件—— Display</a></li><li><a href="/Books/Vue.js 组件精讲/实战 4：全局提示组件——$Alert.html" class="sidebar-link">实战 4：全局提示组件——$Alert</a></li><li><a href="/Books/Vue.js 组件精讲/更灵活的组件：Render 函数与 Functional Render.html" class="sidebar-link">更灵活的组件：Render 函数与 Functional Render</a></li><li><a href="/Books/Vue.js 组件精讲/递归组件与动态组件.html" class="sidebar-link">递归组件与动态组件</a></li><li><a href="/Books/Vue.js 组件精讲/实战 7：树形控件——Tree.html" class="sidebar-link">实战 7：树形控件——Tree</a></li><li><a href="/Books/Vue.js 组件精讲/拓展：Vue.js 容易忽略的 API 详解.html" class="sidebar-link">拓展：Vue.js 容易忽略的 API 详解</a></li><li><a href="/Books/Vue.js 组件精讲/拓展：Vue.js 面试、常见问题答疑.html" class="sidebar-link">拓展：Vue.js 面试、常见问题答疑</a></li><li><a href="/Books/Vue.js 组件精讲/拓展：如何做好一个开源项目（上篇）.html" class="sidebar-link">拓展：如何做好一个开源项目（上篇）</a></li><li><a href="/Books/Vue.js 组件精讲/拓展：如何做好一个开源项目（下篇）.html" class="sidebar-link">拓展：如何做好一个开源项目（下篇）</a></li><li><a href="/Books/Vue.js 组件精讲/写在最后.html" class="sidebar-link">写在最后</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="组件的通信-3：找到任意组件实例——findcomponents-系列方法"><a href="#组件的通信-3：找到任意组件实例——findcomponents-系列方法" aria-hidden="true" class="header-anchor">#</a> 组件的通信 3：找到任意组件实例——findComponents 系列方法</h1> <h2 id="概述"><a href="#概述" aria-hidden="true" class="header-anchor">#</a> 概述</h2> <p>前面的小节我们已经介绍了两种组件间通信的方法：provide / inject 和 dispatch / broadcast。它们有各自的使用场景和局限，比如前者多用于子组件获取父组件的状态，后者常用于父子组件间通过自定义事件通信。</p> <p>本节将介绍第 3 种组件通信方法，也就是 findComponents 系列方法，它并非 Vue.js 内置，而是需要自行实现，以工具函数的形式来使用，它是一系列的函数，可以说是组件通信的终极方案。findComponents 系列方法最终都是返回组件的实例，进而可以读取或调用该组件的数据和方法。</p> <p>它适用于以下场景：</p> <ul><li>由一个组件，向上找到最近的指定组件；</li> <li>由一个组件，向上找到所有的指定组件；</li> <li>由一个组件，向下找到最近的指定组件；</li> <li>由一个组件，向下找到所有指定的组件；</li> <li>由一个组件，找到指定组件的兄弟组件。</li></ul> <p>5 个不同的场景，对应 5 个不同的函数，实现原理也大同小异。</p> <h2 id="实现"><a href="#实现" aria-hidden="true" class="header-anchor">#</a> 实现</h2> <p>5 个函数的原理，都是通过递归、遍历，找到指定组件的 <code>name</code> 选项匹配的组件实例并返回。</p> <blockquote><p>本节以及后续章节，都是基于上一节的工程来完成，后续不再重复说明。</p> <p>完整源码地址：<a href="https://github.com/icarusion/vue-component-book" target="_blank" rel="noopener noreferrer">https://github.com/icarusion/vue-component-book<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>在目录 <code>src</code> 下新建文件夹 <code>utils</code> 用来放置工具函数，并新建文件 <code>assist.js</code>，本节所有函数都在这个文件里完成，每个函数都通过 <code>export</code> 对外提供（如果你不了解 export，请查看扩展阅读1）。</p> <h3 id="向上找到最近的指定组件——findcomponentupward"><a href="#向上找到最近的指定组件——findcomponentupward" aria-hidden="true" class="header-anchor">#</a> 向上找到最近的指定组件——findComponentUpward</h3> <p>先看代码：</p> <div class="language- extra-class"><pre class="language-text"><code>// assist.js
// 由一个组件，向上找到最近的指定组件
function findComponentUpward (context, componentName) {
  let parent = context.$parent;
  let name = parent.$options.name;

  while (parent &amp;&amp; (!name || [componentName].indexOf(name) &lt; 0)) {
    parent = parent.$parent;
    if (parent) name = parent.$options.name;
  }
  return parent;
}
export { findComponentUpward };

</code></pre></div><p>findComponentUpward 接收两个参数，第一个是当前上下文，比如你要基于哪个组件来向上寻找，一般都是基于当前的组件，也就是传入 <code>this</code>；第二个参数是要找的组件的 <code>name</code> 。</p> <p>findComponentUpward 方法会在 while 语句里不断向上覆盖当前的 <code>parent</code> 对象，通过判断组件（即 parent）的 name 与传入的 componentName 是否一致，直到直到最近的一个组件为止。</p> <p>与 dispatch 不同的是，findComponentUpward 是直接拿到组件的实例，而非通过事件通知组件。比如下面的示例，有组件 A 和组件 B，A 是 B 的父组件，在 B 中获取和调用 A 中的数据和方法：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;!-- component-a.vue --&gt;
&lt;template&gt;
  &lt;div&gt;
    组件 A
    &lt;component-b&gt;&lt;/component-b&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
  import componentB from './component-b.vue';

  export default {
    name: 'componentA',
    components: { componentB },
    data () {
      return {
        name: 'Aresn'
      }
    },
    methods: {
      sayHello () {
        console.log('Hello, Vue.js');
      }
    }
  }
&lt;/script&gt;

</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>&lt;!-- component-b.vue --&gt;
&lt;template&gt;
  &lt;div&gt;
    组件 B
  &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
  import { findComponentUpward } from '../utils/assist.js';

  export default {
    name: 'componentB',
    mounted () {
      const comA = findComponentUpward(this, 'componentA');
      
      if (comA) {
        console.log(comA.name);  // Aresn
        comA.sayHello();  // Hello, Vue.js
      }
    }
  }
&lt;/script&gt;

</code></pre></div><p>使用起来很简单，只要在需要的地方调用 findComponentUpward 方法就行，第一个参数一般都是传入 this，即当前组件的上下文（实例）。</p> <p>上例的 comA，保险起见，加了一层 <code>if (comA)</code> 来判断是否找到了组件 A，如果没有指定的组件而调用的话，是会报错的。</p> <p>findComponentUpward 只会找到最近的一个组件实例，如果要找到全部符合要求的组件，就需要用到下面的这个方法。</p> <h3 id="向上找到所有的指定组件——findcomponentsupward"><a href="#向上找到所有的指定组件——findcomponentsupward" aria-hidden="true" class="header-anchor">#</a> 向上找到所有的指定组件——findComponentsUpward</h3> <p>代码如下：</p> <div class="language- extra-class"><pre class="language-text"><code>// assist.js
// 由一个组件，向上找到所有的指定组件
function findComponentsUpward (context, componentName) {
  let parents = [];
  const parent = context.$parent;

  if (parent) {
    if (parent.$options.name === componentName) parents.push(parent);
    return parents.concat(findComponentsUpward(parent, componentName));
  } else {
    return [];
  }
}
export { findComponentsUpward };

</code></pre></div><p>与 findComponentUpward 不同的是，findComponentsUpward 返回的是一个数组，包含了所有找到的组件实例（注意函数名称中多了一个“s”）。</p> <p>findComponentsUpward 的使用场景较少，一般只用在递归组件里面（后面小节会介绍），因为这个函数是一直向上寻找父级（parent）的，只有递归组件的父级才是自身。事实上，iView 在使用这个方法也都是用在递归组件的场景，比如菜单组件 Menu。由于递归组件在 Vue.js 组件里面并不常用，那自然 findComponentsUpward 也不常用了。</p> <h3 id="向下找到最近的指定组件——findcomponentdownward"><a href="#向下找到最近的指定组件——findcomponentdownward" aria-hidden="true" class="header-anchor">#</a> 向下找到最近的指定组件——findComponentDownward</h3> <p>代码如下：</p> <div class="language- extra-class"><pre class="language-text"><code>// assist.js
// 由一个组件，向下找到最近的指定组件
function findComponentDownward (context, componentName) {
  const childrens = context.$children;
  let children = null;

  if (childrens.length) {
    for (const child of childrens) {
      const name = child.$options.name;

      if (name === componentName) {
        children = child;
        break;
      } else {
        children = findComponentDownward(child, componentName);
        if (children) break;
      }
    }
  }
  return children;
}
export { findComponentDownward };

</code></pre></div><p><code>context.$children</code> 得到的是当前组件的全部子组件，所以需要遍历一遍，找到有没有匹配到的组件 <code>name</code>，如果没找到，继续递归找每个 $children 的 $children，直到找到最近的一个为止。</p> <p>来看个示例，仍然是 A、B 两个组件，A 是 B 的父组件，在 A 中找到 B：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;!-- component-b.vue --&gt;
&lt;template&gt;
  &lt;div&gt;
    组件 B
  &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
  export default {
    name: 'componentB',
    data () {
      return {
        name: 'Aresn'
      }
    },
    methods: {
      sayHello () {
        console.log('Hello, Vue.js');
      }
    }
  }
&lt;/script&gt;

</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>&lt;!-- component-a.vue --&gt;
&lt;template&gt;
  &lt;div&gt;
    组件 A
    &lt;component-b&gt;&lt;/component-b&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
  import componentB from './component-b.vue';
  import { findComponentDownward } from '../utils/assist.js';

  export default {
    name: 'componentA',
    components: { componentB },
    mounted () {
      const comB = findComponentDownward(this, 'componentB');
      if (comB) {
        console.log(comB.name);  // Aresn
        comB.sayHello();  // Hello, Vue.js
      }
    }
  }
&lt;/script&gt;

</code></pre></div><p>示例中的 A 和 B 是父子关系，因此也可以直接用 <code>ref</code> 来访问，但如果不是父子关系，中间间隔多代，用它就很方便了。</p> <h3 id="向下找到所有指定的组件——findcomponentsdownward"><a href="#向下找到所有指定的组件——findcomponentsdownward" aria-hidden="true" class="header-anchor">#</a> 向下找到所有指定的组件——findComponentsDownward</h3> <p>如果要向下找到所有的指定组件，要用到 findComponentsDownward 函数，代码如下：</p> <div class="language- extra-class"><pre class="language-text"><code>// assist.js
// 由一个组件，向下找到所有指定的组件
function findComponentsDownward (context, componentName) {
  return context.$children.reduce((components, child) =&gt; {
    if (child.$options.name === componentName) components.push(child);
    const foundChilds = findComponentsDownward(child, componentName);
    return components.concat(foundChilds);
  }, []);
}
export { findComponentsDownward };

</code></pre></div><p>这个函数实现的方式有很多，这里巧妙使用 <code>reduce</code> 做累加器，并用递归将找到的组件合并为一个数组并返回，代码量较少，但理解起来稍困难。</p> <p>用法与 findComponentDownward 大同小异，就不再写用例了。</p> <h3 id="找到指定组件的兄弟组件——findbrotherscomponents"><a href="#找到指定组件的兄弟组件——findbrotherscomponents" aria-hidden="true" class="header-anchor">#</a> 找到指定组件的兄弟组件——findBrothersComponents</h3> <p>代码如下：</p> <div class="language- extra-class"><pre class="language-text"><code>// assist.js
// 由一个组件，找到指定组件的兄弟组件
function findBrothersComponents (context, componentName, exceptMe = true) {
  let res = context.$parent.$children.filter(item =&gt; {
    return item.$options.name === componentName;
  });
  let index = res.findIndex(item =&gt; item._uid === context._uid);
  if (exceptMe) res.splice(index, 1);
  return res;
}
export { findBrothersComponents };

</code></pre></div><p>相比其它 4 个函数，findBrothersComponents 多了一个参数 <code>exceptMe</code>，是否把本身除外，默认是 true。寻找兄弟组件的方法，是先获取 <code>context.$parent.$children</code>，也就是父组件的全部子组件，这里面当前包含了本身，所有也会有第三个参数 exceptMe。Vue.js 在渲染组件时，都会给每个组件加一个内置的属性 <code>_uid</code>，这个 _uid 是不会重复的，借此我们可以从一系列兄弟组件中把自己排除掉。</p> <p>举个例子，组件 A 是组件 B 的父级，在 B 中找到所有在 A 中的兄弟组件（也就是所有在 A 中的 B 组件）：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;!-- component-a.vue --&gt;
&lt;template&gt;
  &lt;div&gt;
    组件 A
    &lt;component-b&gt;&lt;/component-b&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
  import componentB from './component-b.vue';
  
  export default {
    name: 'componentA',
    components: { componentB }
  }
&lt;/script&gt;

</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>&lt;!-- component-b.vue --&gt;
&lt;template&gt;
  &lt;div&gt;
    组件 B
  &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
  import { findBrothersComponents } from '../utils/assist.js';
  
  export default {
    name: 'componentB',
    mounted () {
      const comsB = findBrothersComponents(this, 'componentB');
      console.log(comsB);  // ① []，空数组
    }
  }
&lt;/script&gt;

</code></pre></div><p>在 ① 的位置，打印出的内容为空数组，原因是当前 A 中只有一个 B，而 findBrothersComponents 的第三个参数默认是 true，也就是将自己除外。如果在 A 中再写一个 B：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;!-- component-a.vue --&gt;
&lt;template&gt;
  &lt;div&gt;
    组件 A
    &lt;component-b&gt;&lt;/component-b&gt;
    &lt;component-b&gt;&lt;/component-b&gt;
  &lt;/div&gt;
&lt;/template&gt;

</code></pre></div><p>这时就会打印出 <code>[VueComponent]</code>，有一个组件了，但要注意在控制台会打印两遍，因为在 A 中写了两个 B，而 <code>console.log</code> 是在 B 中定义的，所以两个都会执行到。如果你看懂了这里，那应该明白打印的两遍 <code>[VueComponent]</code>，分别是另一个 <code>&lt;component-b&gt;</code>（如果没有搞懂，要仔细琢磨琢磨哦）。</p> <p>如果将 B 中 findBrothersComponents 的第三个参数设置为 false：</p> <div class="language- extra-class"><pre class="language-text"><code>// component-b.vue
export default {
  name: 'componentB',
  mounted () {
    const comsB = findBrothersComponents(this, 'componentB', false);
    console.log(comsB);
  }
}

</code></pre></div><p>此时就会打印出 <code>[VueComponent, VueComponent]</code>，也就是包含自身了。</p> <p>以上就是 5 个函数的详细介绍，get 到这 5 个，以后就再也不用担心组件通信了。</p> <h2 id="结语"><a href="#结语" aria-hidden="true" class="header-anchor">#</a> 结语</h2> <p>只有你认真开发过 Vue.js 独立组件，才会明白这 5 个函数的强大之处。</p> <h2 id="扩展阅读"><a href="#扩展阅读" aria-hidden="true" class="header-anchor">#</a> 扩展阅读</h2> <ul><li><a href="http://es6.ruanyifeng.com/#docs/module" target="_blank" rel="noopener noreferrer">ES6 Module 的语法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>注：本节部分代码参考 <a href="https://github.com/iview/iview/blob/2.0/src/utils/assist.js" target="_blank" rel="noopener noreferrer">iView<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Books/Vue.js 组件精讲/实战 1：具有数据校验功能的表单组件——Form.html" class="prev">实战 1：具有数据校验功能的表单组件——Form</a></span> <span class="next"><a href="/Books/Vue.js 组件精讲/实战 2：组合多选框组件——CheckboxGroup &amp; Checkbox.html">实战 2：组合多选框组件——CheckboxGroup &amp; Checkbox</a>→
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.5fc14d0c.js" defer></script><script src="/assets/js/3.49a4f85b.js" defer></script><script src="/assets/js/35.39fb3530.js" defer></script>
  </body>
</html>
